'use strict';
const logMod = require('./logger');
const StatsD = require('node-statsd');
const dummyClient = () => {
    return {
        increment: function () { },
        timing: function () { },
        decrement: function () { },
        histogram: function () { },
        gauge: function () { },
        set: function () { },
        unique: function () { }
    };
};
const requiredEnv = ['STATSD_HOST', 'STATSD_PORT', 'STATSD_PREFIX'];
const missingEnv = () => requiredEnv.filter((e) => !process.env[e])[0];
const createClient = function (logArg) {
    const log = logArg || logMod.child({
        module: 'statsd'
    });
    if (missingEnv()) {
        log.warn("Can't initialize statsd, missing env: " + missingEnv());
        return dummyClient();
    }
    const client = new StatsD({
        host: process.env.STATSD_HOST,
        port: process.env.STATSD_PORT,
        prefix: process.env.STATSD_PREFIX
    });
    client.socket.on('error', function (error) {
        return log.error('error in socket', error);
    });
    return client;
};
module.exports = {
    createClient: createClient,
    dummyClient: dummyClient
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RhdHNkLXdyYXBwZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvc3RhdHNkLXdyYXBwZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsWUFBWSxDQUFDO0FBRWIsTUFBTSxNQUFNLEdBQUcsT0FBTyxDQUFDLFVBQVUsQ0FBQyxDQUFDO0FBQ25DLE1BQU0sTUFBTSxHQUFHLE9BQU8sQ0FBQyxhQUFhLENBQUMsQ0FBQztBQUN0QyxNQUFNLFdBQVcsR0FBRyxHQUFHLEVBQUU7SUFDdkIsT0FBTztRQUNMLFNBQVMsRUFBRSxjQUFhLENBQUM7UUFDekIsTUFBTSxFQUFFLGNBQWEsQ0FBQztRQUN0QixTQUFTLEVBQUUsY0FBYSxDQUFDO1FBQ3pCLFNBQVMsRUFBRSxjQUFhLENBQUM7UUFDekIsS0FBSyxFQUFFLGNBQWEsQ0FBQztRQUNyQixHQUFHLEVBQUUsY0FBYSxDQUFDO1FBQ25CLE1BQU0sRUFBRSxjQUFhLENBQUM7S0FDdkIsQ0FBQztBQUNKLENBQUMsQ0FBQztBQUVGLE1BQU0sV0FBVyxHQUFHLENBQUMsYUFBYSxFQUFFLGFBQWEsRUFBRSxlQUFlLENBQUMsQ0FBQztBQUVwRSxNQUFNLFVBQVUsR0FBRyxHQUFHLEVBQUUsQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUV2RSxNQUFNLFlBQVksR0FBRyxVQUFVLE1BQU07SUFDbkMsTUFBTSxHQUFHLEdBQUcsTUFBTSxJQUFJLE1BQU0sQ0FBQyxLQUFLLENBQUM7UUFDakMsTUFBTSxFQUFFLFFBQVE7S0FDakIsQ0FBQyxDQUFDO0lBQ0gsSUFBSSxVQUFVLEVBQUUsRUFBRTtRQUNoQixHQUFHLENBQUMsSUFBSSxDQUFDLHdDQUF3QyxHQUFHLFVBQVUsRUFBRSxDQUFDLENBQUM7UUFDbEUsT0FBTyxXQUFXLEVBQUUsQ0FBQztLQUN0QjtJQUNELE1BQU0sTUFBTSxHQUFHLElBQUksTUFBTSxDQUFDO1FBQ3hCLElBQUksRUFBRSxPQUFPLENBQUMsR0FBRyxDQUFDLFdBQVc7UUFDN0IsSUFBSSxFQUFFLE9BQU8sQ0FBQyxHQUFHLENBQUMsV0FBVztRQUM3QixNQUFNLEVBQUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxhQUFhO0tBQ2xDLENBQUMsQ0FBQztJQUNILE1BQU0sQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLE9BQU8sRUFBRSxVQUFVLEtBQUs7UUFDdkMsT0FBTyxHQUFHLENBQUMsS0FBSyxDQUFDLGlCQUFpQixFQUFFLEtBQUssQ0FBQyxDQUFDO0lBQzdDLENBQUMsQ0FBQyxDQUFDO0lBQ0gsT0FBTyxNQUFNLENBQUM7QUFDaEIsQ0FBQyxDQUFDO0FBRUYsTUFBTSxDQUFDLE9BQU8sR0FBRztJQUNmLFlBQVksRUFBRSxZQUFZO0lBQzFCLFdBQVcsRUFBRSxXQUFXO0NBQ3pCLENBQUMifQ==