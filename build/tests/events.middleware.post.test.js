// unit tests for events.middleware.post
'use strict';
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const testdouble_1 = __importDefault(require("testdouble"));
const restify_1 = __importDefault(require("restify"));
const parse_http_params_1 = require("../src/parse-http-params");
const chai_1 = require("chai");
const { anything, isA } = testdouble_1.default.matchers;
const { verify, when } = testdouble_1.default;
const calledOnce = { times: 1, ignoreExtraArgs: true };
describe('events.middleware.post', () => {
    let poll;
    let store;
    let middleware;
    let log;
    let req;
    let res;
    let next;
    const FAILING_ADD_CHANNEL = 'failing-add-channel';
    const FAILING_EMIT_CHANNEL = 'failing-emit-channel';
    const SUCCESS_CHANNEL = 'success-channel';
    const SUCCESS_EVENT = {
        from: 'from',
        type: 'type',
        data: { a: 1, b: 2 }
    };
    const SUCCESS_ID = 3;
    const SUCCESS_EVENT_WITH_ID = Object.assign({ id: SUCCESS_ID }, SUCCESS_EVENT);
    const testChannels = {};
    // FAILING_ADD_CHANNEL:
    //  - addEvent fails with a InternalServerError
    testChannels[FAILING_ADD_CHANNEL] = () => {
        when(store.addEvent(FAILING_ADD_CHANNEL, anything()))
            .thenCallback(new restify_1.default.InternalServerError());
    };
    // SUCCESS_CHANNEL:
    //  - addEvent and emit succeeds
    testChannels[SUCCESS_CHANNEL] = () => {
        when(store.addEvent(SUCCESS_CHANNEL, SUCCESS_EVENT))
            .thenCallback(null, SUCCESS_EVENT_WITH_ID);
        testdouble_1.default.when(poll.emit(SUCCESS_CHANNEL, anything()))
            .thenCallback(null);
    };
    // FAILING_EMIT_CHANNEL:
    //  - addEvent succeeds
    //  - emit fails with a InternalServerError
    testChannels[FAILING_EMIT_CHANNEL] = () => {
        when(store.addEvent(FAILING_EMIT_CHANNEL, SUCCESS_EVENT))
            .thenCallback(null, SUCCESS_EVENT_WITH_ID);
        testdouble_1.default.when(poll.emit(FAILING_EMIT_CHANNEL, anything()))
            .thenCallback(new restify_1.default.InternalServerError());
    };
    beforeEach(() => {
        store = testdouble_1.default.object(['addEvent']);
        when(store.addEvent(anything(), anything()))
            .thenCallback(new Error('unexpected store.addEvent'));
        poll = testdouble_1.default.object(require('../src/poll.js').createPoll({}));
        when(poll.emit(anything(), anything()))
            .thenCallback(new Error('unexpected poll.emit'));
        log = testdouble_1.default.object(['error', 'info']);
        middleware = require('../src/events.middleware.post')
            .createMiddleware({ poll, store, log });
        const input = validInput();
        req = input.req;
        res = input.res;
        next = input.next;
    });
    const validRequest = () => ({
        body: Object.assign({
            clientId: 'test-client'
        }, SUCCESS_EVENT)
    });
    const validInput = () => ({
        req: validRequest(),
        res: testdouble_1.default.object(['json']),
        next: testdouble_1.default.function('next')
    });
    const withChannel = (channel) => {
        if (testChannels[channel])
            testChannels[channel]();
        req.body.channel = channel;
        middleware(req, res, next);
    };
    it('fails when channel parameter is undefined', () => {
        withChannel(undefined);
        verify(next(), calledOnce);
        verify(next(isA(restify_1.default.InvalidContentError)));
    });
    it('fails when store.addEvent fails', () => {
        withChannel(FAILING_ADD_CHANNEL);
        verify(next(), calledOnce);
        verify(next(isA(restify_1.default.InternalServerError)));
    });
    it('logs poll.emit failures to the console', () => {
        withChannel(FAILING_EMIT_CHANNEL);
        verify(next(), calledOnce);
        verify(log.error(), { ignoreExtraArgs: true });
    });
    it('responds with the added event', () => {
        withChannel(SUCCESS_CHANNEL);
        verify(next(), calledOnce);
        verify(next());
        verify(res.json(SUCCESS_EVENT_WITH_ID));
        verify(log.error(), { times: 0, ignoreExtraArgs: true });
    });
    describe('parsePostParams()', () => {
        const from = 'service/v1';
        const type = 'new-something';
        const data = { thing: true };
        const clientId = 'test-client';
        const channel = 'channel';
        it('parses valid stuff', () => {
            (0, chai_1.expect)((0, parse_http_params_1.parsePostParams)({ from, type, data, clientId, channel })).to.eql({
                clientId,
                channel,
                event: { from, type, data },
            });
            (0, chai_1.expect)((0, parse_http_params_1.parsePostParams)({ from, type, clientId, channel })).to.eql({
                clientId,
                channel,
                event: { from, type }
            });
        });
        it('from must be non-empty string', () => {
            const t = (input) => {
                const actual = (0, parse_http_params_1.parsePostParams)(input);
                (0, chai_1.expect)(actual).to.be.instanceof(Error);
                (0, chai_1.expect)(actual.message).to.equal('Invalid from');
            };
            t({ channel, clientId });
            t({ from: '', channel, clientId });
            t({ from: undefined, channel, clientId });
            t({ from: [], channel, clientId });
            t({ from: 42, channel, clientId });
        });
        it('type must be non-empty string', () => {
            const t = (input) => {
                const actual = (0, parse_http_params_1.parsePostParams)(input);
                (0, chai_1.expect)(actual).to.be.instanceof(Error);
                (0, chai_1.expect)(actual.message).to.equal('Invalid type');
            };
            t({ from, channel, clientId });
            t({ type: '', from, channel, clientId });
            t({ type: undefined, from, channel, clientId });
            t({ type: [], from, channel, clientId });
            t({ type: 42, from, channel, clientId });
        });
        it('data must be non-null object or not present', () => {
            const t = (input) => {
                const actual = (0, parse_http_params_1.parsePostParams)(input);
                (0, chai_1.expect)(actual).to.be.instanceof(Error);
                (0, chai_1.expect)(actual.message).to.equal('Invalid data');
            };
            t({ data: '', type, from, channel, clientId });
            t({ data: undefined, type, from, channel, clientId });
            t({ data: 42, type, from, channel, clientId });
            t({ data: null, type, from, channel, clientId });
        });
        it('client id must be non-empty string', () => {
            const t = (input) => {
                const actual = (0, parse_http_params_1.parsePostParams)(input);
                (0, chai_1.expect)(actual).to.be.instanceof(Error);
                (0, chai_1.expect)(actual.message).to.equal('Invalid Client ID');
            };
            t({ channel });
            t({ clientId: '', channel });
            t({ clientId: 42, channel });
            t({ clientId: false, channel });
            t({ clientId: undefined, channel });
        });
        it('channel must be non-empty string', () => {
            const t = (input) => {
                const actual = (0, parse_http_params_1.parsePostParams)(input);
                (0, chai_1.expect)(actual).to.be.instanceof(Error);
                (0, chai_1.expect)(actual.message).to.equal('Invalid Channel');
            };
            t({ clientId });
            t({ channel: '', clientId });
            t({ channel: 42, clientId });
            t({ channel: false, clientId });
            t({ channel: undefined, clientId });
        });
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXZlbnRzLm1pZGRsZXdhcmUucG9zdC50ZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vdGVzdHMvZXZlbnRzLm1pZGRsZXdhcmUucG9zdC50ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLHdDQUF3QztBQUV4QyxZQUFZLENBQUM7Ozs7O0FBRWIsNERBQTRCO0FBQzVCLHNEQUE4QjtBQUM5QixnRUFBeUQ7QUFDekQsK0JBQTRCO0FBRTVCLE1BQU0sRUFBQyxRQUFRLEVBQUUsR0FBRyxFQUFDLEdBQUcsb0JBQUUsQ0FBQyxRQUFRLENBQUM7QUFDcEMsTUFBTSxFQUFDLE1BQU0sRUFBRSxJQUFJLEVBQUMsR0FBRyxvQkFBRSxDQUFDO0FBQzFCLE1BQU0sVUFBVSxHQUFHLEVBQUMsS0FBSyxFQUFFLENBQUMsRUFBRSxlQUFlLEVBQUUsSUFBSSxFQUFDLENBQUM7QUFFckQsUUFBUSxDQUFDLHdCQUF3QixFQUFFLEdBQUcsRUFBRTtJQUV0QyxJQUFJLElBQUksQ0FBQztJQUNULElBQUksS0FBSyxDQUFDO0lBQ1YsSUFBSSxVQUFVLENBQUM7SUFDZixJQUFJLEdBQUcsQ0FBQztJQUNSLElBQUksR0FBRyxDQUFDO0lBQ1IsSUFBSSxHQUFHLENBQUM7SUFDUixJQUFJLElBQUksQ0FBQztJQUVULE1BQU0sbUJBQW1CLEdBQUcscUJBQXFCLENBQUM7SUFDbEQsTUFBTSxvQkFBb0IsR0FBRyxzQkFBc0IsQ0FBQztJQUNwRCxNQUFNLGVBQWUsR0FBRyxpQkFBaUIsQ0FBQztJQUMxQyxNQUFNLGFBQWEsR0FBRztRQUNwQixJQUFJLEVBQUUsTUFBTTtRQUNaLElBQUksRUFBRSxNQUFNO1FBQ1osSUFBSSxFQUFFLEVBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFDO0tBQ25CLENBQUM7SUFDRixNQUFNLFVBQVUsR0FBRyxDQUFDLENBQUM7SUFDckIsTUFBTSxxQkFBcUIsR0FBRyxNQUFNLENBQUMsTUFBTSxD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